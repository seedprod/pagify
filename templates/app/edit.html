{% extends "base.html" %}
{% block title %}Edit - {% endblock %}
{% block head %}
<link rel="stylesheet" href="/static/css/man-in-black/jquery-ui-{{google.jquery_ui_version}}.custom.css">
<link rel="stylesheet" href="/static/css/tipsy.css">
<link rel="stylesheet" href="/static/css/facebox.css">
{% endblock %}
{% block body %}
<div id="primary"> 
    <div id="content">
	<h1>Edit</h1>
		<div id="fb-profile" class="yui3-g">
		    <div id="fb-left-column" class="yui3-u">
		        <img src="http://graph.facebook.com/{{page.id}}/picture?type=large"/>
				<div id="facebook-page-sidebar">
				</div>
		    </div>
			<div id="fb-right-column" class="yui3-u">
				<h1 id="fb-title">{{page.name}}</h1>
		        <!-- Image Header -->
				<!--<div id="pagify-header" class="ui-corner-all boxer">
					<div id="pagify-image" style="width:500px;height:500px;background:url('{{page.header_image_url}}=s540') no-repeat";>
					</div>
				</div>-->
				<img id="pagify-image" class="hand" src="{{page.header_image_url|default_if_none:"/static/images/no-fb-image.png?"}}=s520">
			
				<!-- Widgets -->
				<div id="widget-list" class="">
					{% for w in widgets %}
					<div id="{{w.id}}" class="widget-list-item">
						<span class="wheader">
						<h3><a href="#" class="inline-edit">{{w.name}}</a></h3>
						<span class="btn-delete"><span class="ui-icon ui-icon-trash"></span></span>
						<!--<span class="btn-unlock"><span class="ui-icon ui-icon-unlocked"></span></span>-->
						</span>
						<div>Loading...</div>
						<span class="hidden wtype">{{w.type}}</span>
					</div>
					{% endfor %}
				</div>
			</div>
        </div><!-- #fb-profile-->
    </div><!-- #content -->
</div><!-- #primary -->


    <div id="sb-widgets-menu" class="widget box_round_6">
        <div id="sb-widgets-header">
            <a id="facebook-publish" href="#fbox-install" rel="facebox" class="hand"></a>
    	</div>
    	<div id="controller-tabs">
        	<ul>
        		<li><a href="#tabs-1">Widgets</a></li>
        		<li><a href="#tabs-2">Settings</a></li>
        	</ul>
        	<div id="tabs-1">
        		<p>Drag &amp; drop widgets into the Widget Area on your page.</p>
        		<div class="yui3-g">
        	    <ul class="yui3-u-1-2">
        			<li id="wi-text" class="wi draggable ui-state-default ui-corner-all">Text</li>
        			<li id="wi-twitter" class="wi draggable ui-state-default ui-corner-all">Twitter</li>
        			<li id="wi-flickr" class="wi draggable ui-state-default ui-corner-all">Flickr</li>
        	        <li id="wi-youtube" class="wi draggable ui-state-default ui-corner-all">YouTube</li>
        			
        	    </ul>
        	    <ul class="yui3-u-1-2">
        	        <li id="wi-googlemaps" class="wi draggable ui-state-default ui-corner-all">Google Maps</li>
        			<!--<li id="wi-facebookwall" class="wi draggable ui-state-default ui-corner-all">Facebook Wall</li>-->
        			<li id="wi-feed" class="wi draggable ui-state-default ui-corner-all">Feed</li>
        			<!--<li id="wi-wufoo" class="wi draggable ui-state-default ui-corner-all">WuFoo</li>-->
        	        <!--<li id="wi-mailchimp" class="wi draggable ui-state-default ui-corner-all">MailChimp</li>-->
        	        <li id="wi-embedly" class="wi draggable ui-state-default ui-corner-all">Embedly</li>
        	    </ul>
        	    </div>
        	</div>
        	<div id="tabs-2">
        	    <div id="options_ga" class="gray_boxer">
            		<h3>Google Analytics</h3>
            		<p>Get analytics on your page. Simply give us your Google Analytics Domain ID (something like UA-123456-1) and we'll add it to your page. Leave blank if none.</p>
            		<div>
            		    <input type="text" id="google_analytics_ua"></input>
            		</div>
        		</div>
        	</div>
        </div>
    </div>





<!-- Dialogs -->
<div id="upload-dialog" title="Upload Image" style="display:none;">
    <div id="fileQueue"></div>
    <input type="file" name="uploadify" id="uploadify" />
    <p><a href="javascript:jQuery('#uploadify').uploadifyClearQueue()">Cancel All Uploads</a></p>
</div>
<div id="dialog-delete-confirm" title="Delete Widget?" style="display:none;">
	<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>This widget will be permanently deleted and cannot be recovered. Are you sure?</p>
</div>
<div id="fbox-install" style="display:none;">
    <p>Install instructions.</p>
    <a href="http://www.facebook.com/add.php?api_key={{facebook.api_key}}&pages=1&page={{page.id}}">Install</a>
</div>
<span id="page-id" class="hidden">{{page.id}}</span>
{% endblock %}
{% block foot %}
<script src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<script src="/static/js/jquery-ui-{{google.jquery_ui_version}}.custom.min.js"></script>
<script src="/static/js/jquery.uploadify.v2.1.4.min.js"></script>
<script src="/static/js/jquery.json-2.2.min.js"></script>
<script src="/static/js/facebox.js"></script>
<script>
$.ajaxSetup ({
    // Disable caching of AJAX responses */
    cache: false
});
$(document).ready(function() {
	 // Facebox
    	$.facebox.settings.opacity = 0.7;
    	$('a[rel*=facebox]').facebox();
    	// Tooltips
    	$('#fb-left-column').tipTip({defaultPosition:'top',content: "This is just a test Facebook Page so you can get an idea of what your page will look like after you publish it."});
	// Uploadify
	var scriptUrl = '{{upload_url}}';
	$("#uploadify").uploadify({
		'uploader'       : '/static/swf/uploadify.swf',
		'script'         : scriptUrl,
		'cancelImg'      : '/static/images/cancel.png',
		'folder'         : '{{page_id}}',
		'queueID'        : 'fileQueue',
		'fileExt'        : '*.jpg;*.jpeg;*.png',
		'fileDesc'       : 'Image Files',
		'auto'           : true,
		'multi'          : false,
		'onError': function(event, queueID,fileOb,errorObj) {
		    log('error')
                       if(errorObj.type == 'HTTP' && errorObj.info == '302'){
                          $(".uploadifyQueueItem").fadeOut(function() {
                              $("#fileQueue").html('');
							  // Grab new script url
							  $.get("/api/scripturl", function(data){scriptUrl=data;});
							  //Refresh Picture
							  //$.get("/api/headerimageurl", { p: "{{page.id}}"},function(data){$("#pagify-image").css('background-image','url('+data+'=s540)');});
                              $.get("/api/headerimageurl", { p: "{{page.id}}"},function(data){$("#pagify-image").attr('src',data+'=s520');});
                          });
                          return false;   
                       } else {$.get("/api/scripturl", function(data){scriptUrl=data;});}
                    }
	});
});

var timeout_ga_ua;
$('#google_analytics_ua').bind('textchange', function () {
  clearTimeout(timeout_ga_ua);
  //$('#ajaxFired').html('<strong>Typing...</strong>');
    var self = this;
    timeout_ga_ua = setTimeout(function () {
        log($(self).val());
    //$('#ajaxFired').html('<strong>Saved</strong>: ' + $(self).val());
  }, 1000);
});
</script>
{% endblock %}